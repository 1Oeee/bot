name: Post Stock Prices

on:
  schedule:
    - cron: '*/5 * * * *'   # every 5 minutes
  workflow_dispatch:       # manual trigger

jobs:
  post:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.x
      - name: Install deps
        run: pip install yfinance requests
      - name: Fetch & post
        env:
          WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
          STOCKS: 'AAPL,GOOGL,MSFT'
        run: |
          python - <<'EOF'
          import os, requests
          import yfinance as yf

          url = os.getenv("https://discord.com/api/webhooks/1387991156251430954/sXZK7-IqY817d4_BKJNjXhRxvRib3414vjLjjwmQmro9NJQVHi_zDIxFM3CXlDmxc_Xs")
          symbols = os.getenv("STOCKS").split(",")
          content = "\n".join(
            f"**{s}**: ${yf.Ticker(s).history(period='1m')['Close'][-1]:.2f}"
            for s in symbols
          )
          requests.post(url, json={"content": content})
          EOF

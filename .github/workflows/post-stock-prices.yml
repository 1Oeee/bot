name: ðŸ¤‘ Post Stock Prices to Discord

on:
  schedule:
    # GitHub Actions min cron interval is 5m:
    - cron: '*/5 * * * *'
  workflow_dispatch:    # allows you to run it manually too

jobs:
  post-stocks:
    runs-on: ubuntu-latest

    steps:
      - name: Check out repo
        uses: actions/checkout@v3

      - name: Set up Python 3.x
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Install dependencies
        run: pip install yfinance requests

      - name: Fetch stock prices & post to Discord
        env:
          DISCORD_WEBHOOK_URL: ${{ https://discord.com/api/webhooks/ }}
          # Comma-separated list of symbols you want:
          STOCK_SYMBOLS: AAPL,GOOGL,MSFT,TSLA
        run: |
          python - <<'EOF'
          import os, requests
          import yfinance as yf

          webhook = os.getenv("DISCORD_WEBHOOK_URL")
          symbols = os.getenv("STOCK_SYMBOLS", "").split(",")
          lines = []
          for s in symbols:
              try:
                  data = yf.Ticker(s).history(period="1m")
                  price = data["Close"].iloc[-1]
                  lines.append(f"**{s}**: ${price:.2f}")
              except Exception:
                  lines.append(f"**{s}**: error")
          payload = {"content": "\n".join(lines)}
          resp = requests.post(webhook, json=payload)
          resp.raise_for_status()
          EOF
